<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Arts spending by American</title>

    <!-- D3 and JQuery Javascript -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- Parallel Sets (optional) -->
    <link rel="stylesheet" href="css/parsets.css" type="text/css">
    <script type="text/javascript" src="js/d3.parsets.js"></script>

    <!-- Bootstrap Core CSS  -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link href="css/custom.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700" rel="stylesheet">

    <style>
        div.tooltips {
            z-index: 99;
            position: absolute !important;
            background-color: #fff;
            opacity: 0.9;
            padding: 5px;
        }

        .dimension tspan.name {
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 24px;
            fill: #333;
            font-weight: 600; 
        }

        .category text{
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 16px;
            fill: #333;
            font-weight: 400; 
        }
    </style>
</head>

<body id="page-top">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <h1 class="title margin-top-lg">Analysing how Americans engage in Arts</h1>
                <p class="body-text margin-md">Our visualization explores how Americans participate in the arts based on year, state, age, income, education level and specific art form. We drew our data from the Interuniversity Consortium for Political and Social Research’s (ICPSR) Survey of Public Participation in the Arts. We base our solution on Parallel Sets, a visualization strategy for multivariate, categorical data.</p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="margin-btm-lg">
                    <svg  id="treemap" width="960" height="540"></svg>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="margin-btm-lg" id="parsets">
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    var svg = d3.select("svg#treemap"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    var color = d3.scale.category20c();

    var treemap = d3.layout.treemap()
                    .size([width, height])
                    .round(true)
                    .value(function(d) {
                        return d.size;
                    });

    function initialize(root) {
        root.x = root.y = 0;
        root.dx = width;
        root.dy = height;
        root.depth = 0;
    }

    d3.json("datasets/treemap.json", function(error, data) {
        if (error) throw error;
        
        treemap(data)
        
        console.log(data);

        var cell = svg.selectAll("g")
                    .data(data["children"])
                    .enter().append("g")
                    .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

        cell.append("rect")
            .attr("id", function(d) { return d.name; })
            .attr("width", function(d) { return d.dx; })
            .attr("height", function(d) { return d.dy ; })
            .attr("fill", function(d) { return color(d.name); });

        cell.append("clipPath")
            .attr("id", function(d) { return "clip-" + d.name; })
            .append("use")
            .attr("xlink:href", function(d) { return "#" + d.name; });

        cell.append("text")
            .attr("clip-path", function(d) { console.log(d.name); return "url(#clip-" + d.name + ")"; })
            .append("tspan")
            .attr("x", 4)
            .attr("y", function(d, i) { return 18; })
            .text(function(d) { return d.name; });

        cell.append("title")
            .text(function(d) { return d.name + "\n" + d.value; });
    });


    var chart = d3.parsets();
    
    chart.dimensions(["Artform", "Income", "Age"]);

    var vis = d3.select("#vis").append("svg")
        .attr("width", chart.width())
        .attr("height", chart.height());

    var body = d3.select(".tooltip-container");
    var tooltips = body.append("div")
        .attr("class", "parsets tooltips");

    function drawParsets(data){
        vis.datum(data).call(chart);
        /*chart.tooltip(function(d, i){
            var count = d.count, path = [];
            while (d.parent) {
              if (d.name) path.unshift(d.name);
              d = d.parent;
            }
            
            var x = 0, y = 0, eTop = $('#vis').offset().top;
            x = d3.mouse(body.node())[0];
            y = d3.mouse(body.node())[1] + 460;

            //console.log(eTop);

            d3.select(".tooltips")
                .style("left", ((x+20) + "px"))
                .style("top", ((y-20-140) + "px"))
                .html(path.join(" → ") + "<br>" + count + " (" + Math.round((count/d.count)*100)+ "%)");
        })*/
    }
</script>

<!-- Custom JS -->
<!-- <script type="text/javascript" src="js/custom.js"></script> -->

</html>
